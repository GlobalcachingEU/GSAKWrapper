<?xml version="1.0" encoding="utf-8"?>
<!--
    # This comment is generated by WixEdit, the specific commandline
    # arguments for the WiX Toolset are stored here.

    candleArgs: "<projectfile>" -out "<projectname>.wixobj" -dPlatform=x86 -ext WixUIExtension -ext WixUtilExtension -ext WixNetFxExtension
    lightArgs: "<projectname>.wixobj" -out "<projectname>.msi"  -dWixUILicenseRtf=license.rtf -ext WixUIExtension -ext WixUtilExtension -ext WixNetFxExtension
-->
<?if $(var.Platform) = "x64"  ?>
<?define progFolder = "ProgramFiles64Folder"?>
<?else ?>
<?define progFolder = "ProgramFilesFolder"?>
<?endif ?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <Product Id="*" Name="GSAKWrapper" Language="1033" Version="$(var.Version)" UpgradeCode="74835D8E-9AA2-4814-ACFD-AD6518441770" Manufacturer="Globalcaching.eu">
        <Package Description="GSAKWrapper" Comments="For more information check https://github.com/GlobalcachingEU/GSAKWrapper/wiki" InstallerVersion="300" Compressed="yes" Platform="$(var.Platform)" />
        <!--
			Source media for the installation. 
 			Specifies a single cab file to be embedded in the installer's .msi. 
		-->
        <Media Id="1" Cabinet="contents.cab" EmbedCab="yes" CompressionLevel="high" />
        <!-- Installation directory and files are defined in Files.wxs -->
        <Directory Id="TARGETDIR" Name="SourceDir">
        </Directory>
        <Feature Id="Complete" Title="GSAKWrapper" Description="GSAKWrapper" Level="1">
            <ComponentRef Id="Main" />
          <ComponentRef Id="ApplicationShortcut" />
          <ComponentRef Id="ApplicationShortcutDesktop" />
        </Feature>
        <!-- 
			Using the Wix UI library
 
			WixUI_InstallDir does not allow the user to choose 
			features but adds a dialog to let the user choose a 
			directory where the product will be installed
		-->
        <Property Id="WIXUI_INSTALLDIR">INSTALLDIR</Property>
        <UIRef Id="WixUI_InstallDir" />
        <MajorUpgrade Schedule="afterInstallInitialize" DowngradeErrorMessage="A later version of [ProductName] is already installed. Setup will now exit." />
        <UI>
            <Publish Dialog="ExitDialog" Control="Finish" Event="DoAction" Value="LaunchApplication">WIXUI_EXITDIALOGOPTIONALCHECKBOX = 1 and NOT Installed</Publish>
        </UI>
        <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT" Value="Launch GSAKWrapper" />
        <Property Id="WixShellExecTarget" Value="[#Exec]" />
        <CustomAction Id="LaunchApplication" BinaryKey="WixCA" DllEntry="WixShellExec" Impersonate="yes" />
        <PropertyRef Id="NETFRAMEWORK45" />
        <Condition Message="This application requires .NET Framework 4.5.2."><![CDATA[Installed OR (NETFRAMEWORK45 >= "#379393")]]></Condition>
    </Product>
    <Fragment>
        <DirectoryRef Id="TARGETDIR">
            <Directory Id="DesktopFolder" Name="Desktop">
                <Component Id="ApplicationShortcutDesktop" Guid="B972DDFA-457A-4FDC-A204-8BEE6F80DAF8">
                    <Shortcut Id="ApplicationDesktopShortcut" Name="GSAKWrapper" Description="GSAKWrapper" Target="[INSTALLDIR]GSAKWrapper.exe" WorkingDirectory="INSTALLDIR" />
                    <RemoveFolder Id="DesktopFolder" On="uninstall" />
                    <RegistryValue Root="HKCU" Key="Software\Microsoft\GSAKWrapper" Name="installed" Type="integer" Value="1" KeyPath="yes" />
                </Component>
            </Directory>
            <Directory Id="$(var.progFolder)" Name="PFiles">
                <Directory Id="INSTALLDIR" Name="GSAKWrapper">
                    <Component Id="Main" Guid="755698D2-2AD9-4CBC-93C4-3ACE456DD634" DiskId="1">
                        <File Id="LicenseFile" Name="license.rtf" Source="license.rtf" />
                        <File Id="Exec" Name="GSAKWrapper.exe" Source="../GSAKWrapper/bin/Release/GSAKWrapper.exe" />
                      <File Id="cfg" Name="GSAKWrapper.exe.config" Source="../GSAKWrapper/bin/Release/GSAKWrapper.exe.config" />
                      <File Id="Wrp" Name="GSAKWrapper.gsk" Source="../GSAKWrapper/bin/Release/GSAKWrapper.gsk" />
                      <File Id="Tmpl" Name="GSAKTemplateWrapper.gsk" Source="../GSAKWrapper/bin/Release/GSAKTemplateWrapper.gsk" />
                      <File Id="sql1" Name="System.Data.SQLite.dll" Source="../GSAKWrapper/bin/Release/System.Data.SQLite.dll" />
                      <File Id="sql2" Name="SQLite.Interop.dll" Source="../GSAKWrapper/bin/Release/$(var.Platform)/SQLite.Interop.dll" />
                      <File Id="npc" Name="NPoco.dll" Source="../GSAKWrapper/bin/Release/NPoco.dll" />
                      <File Id="zpl" Name="ICSharpCode.SharpZipLib.dll" Source="../GSAKWrapper/bin/Release/ICSharpCode.SharpZipLib.dll" />
                      <File Id="Hist" Name="History.txt" Source="../History.txt" />
                      <File Id="npi1" Name="NPOI.dll" Source="../GSAKWrapper/bin/Release/NPOI.dll" />
                      <File Id="npi2" Name="NPOI.OpenXml4Net.dll" Source="../GSAKWrapper/bin/Release/NPOI.OpenXml4Net.dll" />
                      <File Id="npi3" Name="NPOI.OpenXmlFormats.dll" Source="../GSAKWrapper/bin/Release/NPOI.OpenXmlFormats.dll" />
                      <File Id="npi4" Name="NPOI.OOXML.dll" Source="../GSAKWrapper/bin/Release/NPOI.OOXML.dll" />
                      <File Id="ave1" Name="ICSharpCode.AvalonEdit.dll" Source="../GSAKWrapper/bin/Release/ICSharpCode.AvalonEdit.dll" />
                      <File Id="ave2" Name="ICSharpCode.CodeCompletion.dll" Source="../GSAKWrapper/bin/Release/ICSharpCode.CodeCompletion.dll" />
                      <File Id="ave3" Name="ICSharpCode.NRefactory.dll" Source="../GSAKWrapper/bin/Release/ICSharpCode.NRefactory.dll" />
                      <File Id="ave4" Name="ICSharpCode.NRefactory.Cecil.dll" Source="../GSAKWrapper/bin/Release/ICSharpCode.NRefactory.Cecil.dll" />
                      <File Id="ave5" Name="ICSharpCode.NRefactory.CSharp.dll" Source="../GSAKWrapper/bin/Release/ICSharpCode.NRefactory.CSharp.dll" />
                      <File Id="ave6" Name="ICSharpCode.NRefactory.Xml.dll" Source="../GSAKWrapper/bin/Release/ICSharpCode.NRefactory.Xml.dll" />
                      <File Id="ave7" Name="Mono.Cecil.dll" Source="../GSAKWrapper/bin/Release/Mono.Cecil.dll" />
                      <File Id="ave8" Name="Mono.Cecil.Mdb.dll" Source="../GSAKWrapper/bin/Release/Mono.Cecil.Mdb.dll" />
                      <File Id="ave9" Name="Mono.Cecil.Pdb.dll" Source="../GSAKWrapper/bin/Release/Mono.Cecil.Pdb.dll" />
                      <File Id="ave10" Name="Mono.Cecil.Rocks.dll" Source="../GSAKWrapper/bin/Release/Mono.Cecil.Rocks.dll" />
                      <File Id="ave11" Name="Mono.CSharp.dll" Source="../GSAKWrapper/bin/Release/Mono.CSharp.dll" />
                      <File Id="ave12" Name="CSScriptLibrary.dll" Source="../GSAKWrapper/bin/Release/CSScriptLibrary.dll" />
                      <File Id="ave13" Name="ICSharpCode.NRefactory.IKVM.dll" Source="../Lib/ICSharpCode.NRefactory.IKVM.dll" />
                      <File Id="ave14" Name="IKVM.Reflection.dll" Source="../Lib/IKVM.Reflection.dll" />
                    </Component>
                </Directory>
            </Directory>
            <Directory Id="ProgramMenuFolder" Name="MFiles">
                <Directory Id="MENUDIR" Name="GSAKWrapper">
                    <Component Id="ApplicationShortcut" Guid="A822B0CC-70C2-4782-8B25-6A9837D28697" DiskId="1">
                        <Shortcut Id="ApplicationStartMenuShortcut" Name="GSAKWrapper" Description="GSAKWrapper" Target="[INSTALLDIR]GSAKWrapper.exe" WorkingDirectory="INSTALLDIR" />
                        <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall" />
                        <RegistryValue Root="HKCU" Key="Software\Microsoft\GSAKWrapper" Name="installed" Type="integer" Value="1" KeyPath="yes" />
                    </Component>
                </Directory>
            </Directory>
        </DirectoryRef>
    </Fragment>
</Wix>